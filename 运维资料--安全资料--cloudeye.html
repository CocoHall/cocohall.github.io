<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>cloudeye</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>cloudeye</h1><br/>有时候命令执行，sql查询之类没有回显，可以使被攻击的机器访问指定的web页面或进行DNS解析<br /><br /><br />cloudeye是自己搭建的web服务，存在独立公网IP<br /><br />被攻击机器尝试访问时，cloudeye就会记录有一个IP访问了你的服务器，证明命令执行了<br /><br />或者内网机器没有外网，可是DNSserver有的情况下，访问域名，会有DNS解析记录<br /><br />简易代码：<br /><div class="codebox"><div class="codebox">import&nbsp;socket,thread,datetime<br />query_history&nbsp;=&nbsp;[]<br />url_history&nbsp;=&nbsp;[]<br />def&nbsp;web_server():<br />&nbsp;&nbsp;&nbsp;&nbsp;web&nbsp;=&nbsp;socket.socket(socket.AF_INET,socket.SOCK_STREAM)<br />&nbsp;&nbsp;&nbsp;&nbsp;web.bind((&#39;0.0.0.0&#39;,80))<br />&nbsp;&nbsp;&nbsp;&nbsp;web.listen(10)<br />&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;True:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn,addr&nbsp;=&nbsp;web.accept()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;conn.recv(4096)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req_line&nbsp;=&nbsp;data.split(&quot;\r\n&quot;)[0]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;=&nbsp;req_line.split()[1]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;route_list&nbsp;=&nbsp;path.split(&#39;/&#39;)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;html&nbsp;=&nbsp;&quot;NO&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;len(route_list)&nbsp;==&nbsp;3:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;route_list[1]&nbsp;==&nbsp;&#39;add&#39;:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url_history.append(route_list[2])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;route_list[1]&nbsp;==&nbsp;&#39;check&#39;:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;route_list[2]&nbsp;in&nbsp;url_history:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;html&nbsp;=&nbsp;&#39;YES&#39;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query_str&nbsp;=&nbsp;route_list[1]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;query_raw&nbsp;in&nbsp;query_history:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;query_str&nbsp;in&nbsp;query_raw:html&nbsp;=&nbsp;&quot;YES&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;datetime.datetime.now().strftime(&#39;%m-%d&nbsp;%H:%M:%S&#39;)&nbsp;+&nbsp;&#39;&nbsp;web&nbsp;query:&nbsp;&#39;&nbsp;+&nbsp;path<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raw&nbsp;=&nbsp;&quot;HTTP/1.0&nbsp;200&nbsp;OK\r\nContent-Type:&nbsp;application/json;&nbsp;charset=utf-8\r\nContent-Length:&nbsp;%d\r\nConnection:&nbsp;close\r\n\r\n%s&quot;&nbsp;%(len(html),html)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn.send(raw)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn.close()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pass<br />if&nbsp;__name__==&quot;__main__&quot;:<br />&nbsp;&nbsp;&nbsp;&nbsp;dns&nbsp;=&nbsp;socket.socket(socket.AF_INET,socket.SOCK_DGRAM)<br />&nbsp;&nbsp;&nbsp;&nbsp;dns.bind((&#39;0.0.0.0&#39;,53))<br />&nbsp;&nbsp;&nbsp;&nbsp;thread.start_new_thread(web_server,())<br />&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;True:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recv,addr&nbsp;=&nbsp;dns.recvfrom(1024)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query_history.append(recv)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;datetime.datetime.now().strftime(&#39;%m-%d&nbsp;%H:%M:%S&#39;)&nbsp;+&nbsp;&#39;&nbsp;Dns&nbsp;Query:&nbsp;&#39;&nbsp;+&nbsp;recv</div></div><p align="center"><img src="images\home.svg" height="22" width="22">  <a href="index.html">索引</a></p></div></body></html>