<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>CBC模式攻击</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>CBC模式攻击</h1><br/><br /><br /><br /><div class="codebox"><div class="codebox">#encoding:utf-8<br />#!/usr/bin/env&nbsp;python3<br />import&nbsp;sys<br />def&nbsp;xor(a,&nbsp;b):<br />	return&nbsp;bytes([x&nbsp;^&nbsp;b[i%len(b)]&nbsp;for&nbsp;i,&nbsp;x&nbsp;in&nbsp;enumerate(a)])<br /><br />last&nbsp;=&nbsp;b&#39;Please&nbsp;make&nbsp;sure&nbsp;keep&nbsp;this&nbsp;secret&nbsp;safe.\n&#39;<br />with&nbsp;open(sys.argv[1],&nbsp;&#39;rb&#39;)&nbsp;as&nbsp;f:<br />	encrypted&nbsp;=&nbsp;f.read()<br /><br />def&nbsp;decrypt(cipher,&nbsp;key):<br />	ary&nbsp;=&nbsp;[]<br />	for&nbsp;i&nbsp;in&nbsp;range(len(cipher)-16,&nbsp;0,&nbsp;-16):<br />		plain&nbsp;=&nbsp;xor(xor(cipher[i-16:i],&nbsp;cipher[i:i+16]),&nbsp;key)<br />		ary.append(plain)<br />	return&nbsp;b&#39;&#39;.join(ary[::-1])<br /><br />for&nbsp;i&nbsp;in&nbsp;range(16):			#加密块长度设置为16<br />	padding_len&nbsp;=&nbsp;16&nbsp;-&nbsp;i&nbsp;	#填充的长度<br />			#已知明文的最后几位+pkcs5填充数据<br />	plain&nbsp;=&nbsp;last[-i:]&nbsp;+&nbsp;(chr(padding_len)&nbsp;*	padding_len)<br />	key&nbsp;=&nbsp;xor(xor(encrypted[-16:],&nbsp;encrypted[-32:-16]),&nbsp;plain)<br />	#解密过程中需要当前区块的密文、上一区块的密文、key亦或得到明文<br />	recovered&nbsp;=&nbsp;decrypt(encrypted,&nbsp;key)<br />	bad&nbsp;=&nbsp;False<br /><br />	for&nbsp;i&nbsp;in&nbsp;recovered[:-padding_len]:<br />		if&nbsp;(i&nbsp;&lt;&nbsp;32&nbsp;and&nbsp;i&nbsp;not&nbsp;in&nbsp;[10,&nbsp;13])&nbsp;or&nbsp;i&nbsp;&gt;&nbsp;127:<br />			bad&nbsp;=&nbsp;True<br />			break<br />	if&nbsp;not&nbsp;bad:<br />		print(i,&nbsp;recovered.decode())</div></div><br /><p align="center"><img src="images\home.svg" height="22" width="22">  <a href="index.html">索引</a></p></div></body></html>