<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>静态编译dll</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>静态编译dll</h1><br/>静态编译dll<br /><br /> 1、g++ -c -DBUILD_DLL dcomdll.cpp<br /> 2、g++ -shared -o dcomdll.dll dcomdll.o -Wl,--kill-at -static<br /><br /><br />dcomdll.h<br /><br /><div class="codebox"><div class="codebox">#ifndef&nbsp;__MYDLL_H__<br />#define&nbsp;__MYDLL_H__<br /><br />#include&lt;windows.h&gt;<br /><br />#ifdef&nbsp;BUILD_DLL<br />&nbsp;&nbsp;&nbsp;&nbsp;#define&nbsp;DLL_EXPORT&nbsp;__declspec(dllexport)<br />#else<br />&nbsp;&nbsp;&nbsp;&nbsp;#define&nbsp;DLL_EXPORT&nbsp;__declspec(dllimport)<br />#endif<br /><br />#ifdef&nbsp;__cplusplus<br />extern&nbsp;&quot;C&quot;&nbsp;{<br />#endif<br />&nbsp;&nbsp;&nbsp;&nbsp;DLL_EXPORT&nbsp;int&nbsp;__stdcall&nbsp;setMachineLaunchRestriction(std::string&nbsp;strSid);<br /><br />#ifdef&nbsp;__cplusplus<br />}<br />#endif<br /><br />#endif&nbsp;//&nbsp;__MYDLL_H__<br /></div></div><br /><br />dcomdll.cpp<br /><div class="codebox"><div class="codebox">#include&nbsp;&quot;dcomdll.h&quot;<br /><br />int&nbsp;setMachineLaunchRestriction(std::string&nbsp;strSid){<br />&nbsp;&nbsp;&nbsp;&nbsp;deleteRegKey(&quot;SOFTWARE\\Policies\\Microsoft\\Windows&nbsp;NT\\DCOM&quot;,&quot;MachineLaunchRestriction&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;setSID(strSid,&quot;MachineLaunchRestriction&quot;);<br />}</div></div><br /><br />测试dll:<br />python<br /><div class="codebox"><div class="codebox">import&nbsp;ctypes<br />mydll&nbsp;=&nbsp;ctypes.windll.LoadLibrary(&quot;dcomdll.dll&quot;)<br />print(mydll.getEnableDCOM())<br /></div></div><br /><p align="center"><img src="images\home.svg" height="22" width="22">  <a href="index.html">索引</a></p></div></body></html>