<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>操作注册表</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>操作注册表</h1><br/><br />读REG_SZ<br /><div class="codebox"><div class="codebox">int&nbsp;getEnable(char*&nbsp;keyName){<br />&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;lRet=0;<br />&nbsp;&nbsp;&nbsp;&nbsp;HKEY&nbsp;hKey;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;dwSize=0;<br />&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;char&nbsp;buffer[16]={0};<br />&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;dwType=REG_SZ;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;lRet&nbsp;=&nbsp;RegOpenKeyEx(HKEY_LOCAL_MACHINE,&nbsp;&quot;SOFTWARE\\Microsoft\\Ole&quot;,&nbsp;0,&nbsp;KEY_QUERY_VALUE&nbsp;,&nbsp;&amp;hKey);<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ERROR_SUCCESS&nbsp;==&nbsp;lRet)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwSize=sizeof(buffer);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lRet=RegQueryValueEx(hKey,keyName,NULL,&amp;dwType,buffer,&amp;dwSize);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RegCloseKey(hKey);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(ERROR_SUCCESS&nbsp;==&nbsp;lRet){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(strcmp((char*)buffer,&quot;Y&quot;)==0){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br />}</div></div><br />写REG_SZ keyName不存在会自己创建<br /><div class="codebox"><div class="codebox">int&nbsp;setEnable(DWORD&nbsp;value,char&nbsp;*&nbsp;keyName){<br />&nbsp;&nbsp;&nbsp;&nbsp;HKEY&nbsp;hKey;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;LONG&nbsp;lRet&nbsp;=&nbsp;RegOpenKeyEx(HKEY_LOCAL_MACHINE,&nbsp;&quot;SOFTWARE\\Microsoft\\Ole&quot;,&nbsp;0,&nbsp;KEY_WRITE&nbsp;,&nbsp;&amp;hKey);<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ERROR_SUCCESS&nbsp;!=&nbsp;lRet)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;switch(value){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;1:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*pchrNameY&nbsp;=&nbsp;&quot;Y&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lRet&nbsp;=&nbsp;RegSetValueEx(hKey,&nbsp;keyName,&nbsp;NULL,&nbsp;REG_SZ,&nbsp;(LPBYTE)pchrNameY,&nbsp;strlen(pchrNameY)&nbsp;*&nbsp;sizeof(char)&nbsp;+&nbsp;1);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;0:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;char&nbsp;*pchrNameN&nbsp;=&nbsp;&quot;N&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lRet&nbsp;=&nbsp;RegSetValueEx(hKey,&nbsp;keyName,&nbsp;NULL,&nbsp;REG_SZ,&nbsp;(LPBYTE)pchrNameN,&nbsp;strlen(pchrNameN)&nbsp;*&nbsp;sizeof(char)&nbsp;+&nbsp;1);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default&nbsp;:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lRet=-1;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;RegCloseKey(hKey);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;lRet;<br />}</div></div><br /><br />读DWORD<br /><div class="codebox"><div class="codebox">int&nbsp;getLevel(char&nbsp;*&nbsp;keyName){<br />&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;lRet=0;<br />&nbsp;&nbsp;&nbsp;&nbsp;HKEY&nbsp;hKey;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;dwSize=0;<br />&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;dwResult=2;<br />&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;dwType=REG_DWORD;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;lRet&nbsp;=&nbsp;RegOpenKeyEx(HKEY_LOCAL_MACHINE,&nbsp;&quot;SOFTWARE\\Microsoft\\Ole&quot;,&nbsp;0,&nbsp;KEY_QUERY_VALUE&nbsp;,&nbsp;&amp;hKey);<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ERROR_SUCCESS&nbsp;==&nbsp;lRet)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwSize=sizeof(dwResult);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lRet=RegQueryValueEx(hKey,keyName,NULL,&amp;dwType,(PBYTE)&amp;dwResult,&amp;dwSize);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RegCloseKey(hKey);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;dwResult;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;dwResult;<br />}</div></div><br />写DWORD<br /><div class="codebox"><div class="codebox">int&nbsp;setLevel(DWORD&nbsp;value,char&nbsp;*&nbsp;keyName){<br />&nbsp;&nbsp;&nbsp;&nbsp;HKEY&nbsp;hKey;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;LONG&nbsp;lRet&nbsp;=&nbsp;RegOpenKeyEx(HKEY_LOCAL_MACHINE,&nbsp;&quot;SOFTWARE\\Microsoft\\Ole&quot;,&nbsp;0,&nbsp;KEY_WRITE&nbsp;,&nbsp;&amp;hKey);<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ERROR_SUCCESS&nbsp;!=&nbsp;lRet)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;lRet&nbsp;=&nbsp;RegSetValueEx(hKey,&nbsp;keyName,&nbsp;NULL,&nbsp;REG_DWORD,&nbsp;(CONST&nbsp;BYTE*)&amp;value,&nbsp;sizeof(DWORD));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;RegCloseKey(hKey);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;lRet;<br />}</div></div><br /><br />读REG_BINARY<br /><div class="codebox"><div class="codebox">std::string&nbsp;getDefault(char&nbsp;*&nbsp;keyName){<br />&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;lRet=0;<br />&nbsp;&nbsp;&nbsp;&nbsp;HKEY&nbsp;hKey;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;dwSize=0;<br />&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;char&nbsp;buffer[4096]={0};<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;lRet&nbsp;=&nbsp;RegOpenKeyEx(HKEY_LOCAL_MACHINE,&nbsp;&quot;SOFTWARE\\Microsoft\\Ole&quot;,&nbsp;0,&nbsp;KEY_QUERY_VALUE&nbsp;,&nbsp;&amp;hKey);<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ERROR_SUCCESS&nbsp;==&nbsp;lRet)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwSize=sizeof(buffer);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lRet=RegQueryValueEx(hKey,keyName,NULL,NULL,buffer,&amp;dwSize);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RegCloseKey(hKey);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(ERROR_SUCCESS&nbsp;==&nbsp;lRet){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LPSTR&nbsp;lpAPermission[1]&nbsp;=&nbsp;{0};<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ConvertSecurityDescriptorToStringSecurityDescriptor((PSECURITY_DESCRIPTOR)buffer,&nbsp;SECURITY_DESCRIPTOR_REVISION,&nbsp;DACL_SECURITY_INFORMATION&nbsp;|&nbsp;GROUP_SECURITY_INFORMATION&nbsp;|&nbsp;OWNER_SECURITY_INFORMATION&nbsp;|&nbsp;SACL_SECURITY_INFORMATION,&nbsp;lpAPermission,&nbsp;NULL);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;std::string((char*)lpAPermission[0]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;//增加默认DCOM设置<br />}</div></div><br />写REG_BINARY<br /><div class="codebox"><div class="codebox">int&nbsp;setSID(std::string&nbsp;strSid,char&nbsp;*&nbsp;keyName){<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;PSECURITY_DESCRIPTOR&nbsp;vSecurityDescriptor1{};<br />&nbsp;&nbsp;&nbsp;&nbsp;ULONG&nbsp;&nbsp;vNeedBytes1&nbsp;=&nbsp;0;<br />&nbsp;&nbsp;&nbsp;&nbsp;ConvertStringSecurityDescriptorToSecurityDescriptorA(strSid.c_str(),&nbsp;1,&nbsp;&amp;vSecurityDescriptor1,&nbsp;&amp;vNeedBytes1);<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(vNeedBytes1&nbsp;&lt;&nbsp;1)return&nbsp;-1;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;HKEY&nbsp;hKey;<br />&nbsp;&nbsp;&nbsp;&nbsp;LONG&nbsp;lRet&nbsp;=&nbsp;RegOpenKeyEx(HKEY_LOCAL_MACHINE,&nbsp;&quot;SOFTWARE\\Microsoft\\Ole&quot;,&nbsp;0,&nbsp;KEY_WRITE&nbsp;,&nbsp;&amp;hKey);<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ERROR_SUCCESS&nbsp;!=&nbsp;lRet)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;lRet&nbsp;=&nbsp;::RegSetValueEx(hKey,&nbsp;keyName,&nbsp;NULL,&nbsp;REG_BINARY,&nbsp;(LPBYTE)vSecurityDescriptor1,&nbsp;vNeedBytes1);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;RegCloseKey(hKey);&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;lRet;<br />}</div></div><br /><br /><p align="center"><img src="images\home.svg" height="22" width="22">  <a href="index.html">索引</a></p></div></body></html>