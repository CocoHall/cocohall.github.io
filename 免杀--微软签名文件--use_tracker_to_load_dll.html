<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>use tracker to load dll</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>use tracker to load dll</h1><br/>tracker.exe来自于SDK中，包含微软的数字签名，<br /><br />这个技巧有如下特点：<br />  •     tracker.exe包含微软数字签名，可绕过应用程序白名单的限制<br />  <br />  •     tracker.exe可以在启动进程的同时加载dll<br />  <br />但是如果只想通过tracker.exe加载dll的话，存在以下问题：<br />选择不存在或是权限不够的进程，无法加载dll<br />但是，可以通过一个特殊的进程来解决这个问题，如svchost.exe，<br />那么在加载dll后，进程svchost.exe可以自动退出,这就实现了通过tracker.exe加载dll<br /><br /><br /><br /><br /><br />路径：<br /><a href="file://C:\Program Files (x86)\Microsoft SDKs\Windows\v10.0A\bin\NETFX 4.6.1 Tools">C:\Program Files (x86)\Microsoft SDKs\Windows\v10.0A\bin\NETFX 4.6.1 Tools</a><br /><a href="file://C:\Program Files (x86)\Microsoft SDKs\Windows\v10.0A\bin\NETFX 4.6.1 Tools\x64">C:\Program Files (x86)\Microsoft SDKs\Windows\v10.0A\bin\NETFX 4.6.1 Tools\x64</a><br /><br /><br />直接利用tracker.exe加载dll的<br /><br />Tracker.exe /d test.dll /c cmd.exe<br /><br />该dll代码如下：<br /><br /><div class="codebox"><div class="codebox">#include&nbsp;&quot;stdafx.h&quot;<br />#include&nbsp;&lt;windows.h&gt;<br />BOOL&nbsp;APIENTRY&nbsp;DllMain(&nbsp;HMODULE&nbsp;hModule,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;&nbsp;ul_reason_for_call,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LPVOID&nbsp;lpReserved<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br />{<br />&nbsp;&nbsp;switch&nbsp;(ul_reason_for_call)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;case&nbsp;DLL_PROCESS_ATTACH:<br />&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,L&quot;testexport&quot;,&nbsp;L&quot;testexport&quot;,MB_OK);<br />&nbsp;&nbsp;case&nbsp;DLL_THREAD_ATTACH:<br />&nbsp;&nbsp;case&nbsp;DLL_THREAD_DETACH:<br />&nbsp;&nbsp;case&nbsp;DLL_PROCESS_DETACH:<br />&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;return&nbsp;TRUE;<br />}<br /></div></div><br /><br /><br /><br /><br /><br />防御：<br />对tracker.exe添加黑名单规则<br /><br /><br /><br /><br /><br /><p align="center"><img src="images\home.svg" height="22" width="22">  <a href="index.html">索引</a></p></div></body></html>