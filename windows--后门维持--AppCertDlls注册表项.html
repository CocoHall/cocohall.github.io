<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>AppCertDlls注册表项</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>AppCertDlls注册表项</h1><br/>如果有进程使用了 <br />CreateProcess、CreateProcessAsUser、CreateProcessWithLoginW、CreateProcessWithTokenW 或 WinExec 函数<br />那么此进程会获取 <br />HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SessionManager\AppCertDlls<br />注册表项，此项下的 dll 都会加载到此进程。<br />dll被加载后可以自动运行<br /><br /><a href=""><img src="images\317-1.png" alt="images\317-1.png" /></a><br /><br />dll代码：<br /><div class="codebox"><div class="codebox">BOOL&nbsp;TestMutex()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;HANDLE&nbsp;hMutex&nbsp;=&nbsp;CreateMutexA(NULL,&nbsp;false,&nbsp;&quot;myself&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;//创建名为myself的互斥体<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(GetLastError()&nbsp;==&nbsp;ERROR_ALREADY_EXISTS)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(hMutex);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br />}<br />BOOL&nbsp;APIENTRY&nbsp;DllMain(&nbsp;HMODULE&nbsp;hModule,&nbsp;DWORD&nbsp;&nbsp;ul_reason_for_call,&nbsp;LPVOID&nbsp;lpReserved)<br /><span style="color:#000000;font-weight:400">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(ul_reason_for_call)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;DLL_PROCESS_ATTACH:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(TestMutex()&nbsp;==&nbsp;0)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBoxA(0,&quot;hello&nbsp;topsec&quot;,&quot;AppCert&quot;,0);<br />&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;DLL_THREAD_ATTACH:<br />&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;DLL_THREAD_DETACH:<br />&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;DLL_PROCESS_DETACH:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><p align="center"><img src="images\home.svg" height="22" width="22">  <a href="index.html">索引</a></p></div></body></html>