<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>bitsadmin创建任务</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>bitsadmin创建任务</h1><br/>常用于 Windows Update 的安装更新<br /><br />列出所有任务：bitsadmin /list /allusers /verbose<br />删除某个任务：bitsadmin /cancel &lt;Job&gt;<br />删除所有任务：bitsadmin /reset /allusers<br />完成任务：bitsadmin /complete &lt;Job&gt;<br /><br />通过创建bitsadmin任务实现自动执行<br /><div class="codebox"><div class="codebox">void&nbsp;BitsJob()<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#000000;font-weight:400">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;szSaveName[MAX_PATH]&nbsp;=&nbsp;&quot;C:\\bitshello.exe&quot;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(FALSE&nbsp;==&nbsp;m_Bits)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BOOL&nbsp;bRet&nbsp;=&nbsp;FreeMyResource(IDR_MYRES22,&nbsp;&quot;MYRES2&quot;,&nbsp;szSaveName);//释放资源<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WinExec(&quot;bitsadmin&nbsp;/create&nbsp;TopSec&quot;,&nbsp;0);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WinExec(&quot;bitsadmin&nbsp;/addfile&nbsp;TopSec&nbsp;\&quot;C:\\Windows\\system32\\cmd.exe\&quot;&nbsp;\&quot;C:\\cmd.exe\&quot;&quot;,&nbsp;0);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WinExec(&quot;bitsadmin.exe&nbsp;/SetNotifyCmdLine&nbsp;TopSec&nbsp;\&quot;C:\\Windows\\system32\\cmd.exe\&quot;&nbsp;\&quot;cmd.exe&nbsp;/c&nbsp;C:\\bitshello.exe\&quot;&quot;,&nbsp;0);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WinExec(&quot;bitsadmin&nbsp;/Resume&nbsp;TopSec&quot;,&nbsp;0);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_Bits&nbsp;=&nbsp;TRUE;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WinExec(&quot;bitsadmin&nbsp;/complete&nbsp;TopSec&quot;,&nbsp;0);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remove(szSaveName);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_Bits&nbsp;=&nbsp;FALSE;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdateData(FALSE);<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#000000;font-weight:400">}</span></div></div><br /><br />整理如下：<br />bitsadmin /create TopSec<br />bitsadmin /addfile TopSec &quot;C:\\Windows\\system32\\cmd.exe&quot; &quot;C:\\cmd.exe&quot;                    //给bitsadmin一个下载任务<br />bitsadmin.exe /SetNotifyCmdLine TopSec &quot;C:\\Windows\\system32\\cmd.exe&quot; &quot;cmd.exe /c E:\\rdp.exe&quot;        //下载完成后进行通知，这里可以执行想要的操作<br />bitsadmin /Resume TopSec                                                                                                //重新开始？<br /><br />取消该任务<br />bitsadmin /complete TopSec                                                                                              //确认bitsadmin完成任务，然后删除该任务<br /><br /><br />TopSec：任务名，可以随意取<br /><br /><br /><br />1.BITS 服务的运行状态可以使用 SC 查询程序来监视（命令：sc query bits），任务列表由 BITSAdmin 来查询<br /><p align="center"><img src="images\home.svg" height="22" width="22">  <a href="index.html">索引</a></p></div></body></html>