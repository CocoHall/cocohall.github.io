<!doctype html><html>
    <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
      <title>隐藏用户</title>
      <meta name="generator" content="CherryTree">
      <link rel="stylesheet" href="res/styles3.css" type="text/css" />
    </head>
    <body><div class='page'><h1 class='title'>隐藏用户</h1><br/><a href="https://mp.weixin.qq.com/s/9FSxZ-Qx3Qehjm0NtSoxFQ">https://mp.weixin.qq.com/s/9FSxZ-Qx3Qehjm0NtSoxFQ</a><br /><br /><table style="display:inline-table"><tr><td><a href="EmbeddedFiles\222-Windows-User-Clone.ps1">Linked file: Windows-User-Clone.ps1 </a></td></tr></table><br /><br /><table style="display:inline-table"><tr><td><a href="EmbeddedFiles\222-HideAdmin64.exe">Linked file: HideAdmin64.exe </a></td></tr></table><table style="display:inline-table"><tr><td><a href="EmbeddedFiles\222-HideAdmin86.exe">Linked file: HideAdmin86.exe </a></td></tr></table><br /><br /><br />查找影子账户的工具<br /><table style="display:inline-table"><tr><td><a href="EmbeddedFiles\222-LP_Check.exe">Linked file: LP_Check.exe </a></td></tr></table><br />Win7 x86<br /><br /><br />1、对注册表赋予权限<br />默认注册表HKEY_LOCAL_MACHINE\SAM\SAM\只有system权限才能修改<br />现在需要为其添加管理员权限<br />右键-权限-选中Administrators，允许完全控制<br />如下图<br /><a href=""><img src="images\222-1.png" alt="images\222-1.png" /></a><br />重新启动注册表regedit.exe，获得对该键值的修改权限<br />2、新建特殊帐户<br /><span style="color:#7f7f7f;">     net user test$ 123456 /addnet localgroup administrators test$ /add</span><br />注：<br />用户名要以$结尾<br />添加后，该帐户可在一定条件下隐藏，输入net user无法获取，如下图<br /><a href=""><img src="images\222-2.png" alt="images\222-2.png" /></a><br />但是，在控制面板能够发现该帐户<br />如下图<br /><a href=""><img src="images\222-3.png" alt="images\222-3.png" /></a><br />3、导出注册表<br />在注册表HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\Names下找到新建的帐户test$<br />获取默认类型为0x3ea<br />将注册表HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\Names\test$导出为1.reg<br />在注册表下能够找到对应类型名称的注册表项HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\000003EA<br />如下图<br /><a href=""><img src="images\222-4.png" alt="images\222-4.png" /></a><br />右键将该键导出为2.reg，保存的文件信息如下图<br /><a href=""><img src="images\222-5.png" alt="images\222-5.png" /></a><br />默认情况下，管理员帐户Administrator对应的注册表键值为HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\000001F4<br />同样，右键将该键导出为3.reg<br />将注册表项HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\000003EA下键F的值替换为HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\000001F4下键F的值，即2.reg中键F的值替换成3.reg中键F的值<br />替换后，如下图<br /><a href=""><img src="images\222-6.png" alt="images\222-6.png" /></a><br />4、命令行删除特殊帐户<br /><span style="color:#7f7f7f;">     net user test$ /del</span><br />5、导入reg文件<br /><span style="color:#7f7f7f;">     regedit /s 1.regregedit /s 2.reg</span><br />隐藏账户制做完成，控制面板不存在帐户test$<br />通过net user无法列出该帐户<br />计算机管理-本地用户和组-用户也无法列出该帐户<br />但可通过如下方式查看：<br /><span style="color:#7f7f7f;">     net user test$</span><br />如下图<br /><a href=""><img src="images\222-7.png" alt="images\222-7.png" /></a><br />无法通过net user test$ /del删除该用户，提示用户不属于此组，如下图<br /><a href=""><img src="images\222-8.png" alt="images\222-8.png" /></a><br />删除方法：<br />删除注册表HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users下对应帐户的键值(共有两处)<br />注：<br />工具HideAdmin能自动实现以上的创建和删除操作<br /><br /><br /><br /><strong>0x04 结合远程桌面多用户登录的利用思路</strong><br />通过以上的介绍，可得出该方法的优点：<br />通过克隆的方式能够继承原帐户的权限<br />在利用上存在以下需要注意的问题：<br />1、复制管理员帐户Administrator<br />需要注意管理员帐户是否被禁用，如果被禁用，那么克隆出的隐藏帐户也是被禁用状态<br />2、复制已有帐户<br />在3389远程登录的利用上存在相同帐户的冲突关系<br />通过cmd开启本机的3389远程登录功能：<br /><span style="color:#7f7f7f;">     REG ADD &quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v  fDenyTSConnections /t REG_DWORD /d 00000000 /fREG ADD  &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal  Server\WinStations\RDP-Tcp&quot; /v PortNumber /t REG_DWORD /d 0x00000d3d /f</span><br />利用以上方法，克隆帐户a的权限，建立隐藏帐户aaa$<br />如果系统当前登录帐号为a，那么使用隐藏帐户aaa$登录的话，会系统被识别为帐户a，导致帐户a下线<br />3、新建帐户再复制<br />进一步，大胆的思考<br />新建管理员帐户b，克隆帐户b，建立隐藏账户bbb$<br />删除管理员帐户b,隐藏账户bbb$仍然有效<br />4、原帐户的维持<br />再进一步<br />克隆帐户a的权限，建立隐藏帐户aaa$<br />修改帐户a的密码，隐藏帐户aaa$仍然有效<br /><br /><p align="center"><img src="images\home.svg" height="22" width="22">  <a href="index.html">索引</a></p></div></body></html>